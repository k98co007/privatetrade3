# USERSTORY v0.2.0

- 작성일: 2026-02-19
- 출처: `docs/userinterview/20260217.md`, `docs/userinterview/20260218.md`
- 언어: 한국어

## 1. 제품 목표와 범위

### 1.1 제품 목표
개인 투자자가 자신의 전략(매수 Trailing Buy + 매도 Trailing Stop)을 키움 REST API 기반 자동매매로 실행하고, 웹브라우저에서 설정/시작/모니터링/결과확인을 일관되게 수행할 수 있도록 한다.

### 1.2 범위(In Scope)
- KOSPI 종목 다중 모니터링(최소 1개 ~ 최대 20개)
- 09:03 기준가 기반 매수 조건 계산
- 조건 충족 "첫 번째" 종목 단일 선택 전액 매수
- 수익 1% 확보 이후 이익보전 80% 룰 기반 매도
- 키움 REST 자격정보 브라우저 입력 및 Git 제외 저장
- 모의/실전 손쉬운 전환
- 브라우저에서 매매 시작 명령
- 브라우저 모니터링 및 결과 리포트 확인
- 세금/수수료 반영 손익 리포트
- 모니터링 화면 자동 갱신(수동 새로고침 비의존)
- 지정 12개 칼럼 기반 실시간 모니터링
- 시간 필드 HH:MM:SS 표기
- 주문 조건 충족 시 증권사 잔액오류와 무관하게 주문 요청 전송
- 모니터링 정보의 리포트 연계 조회
- 리포트 현재 가격의 15:30 종가 기준 일치

### 1.3 범위 제외(Out of Scope)
- 복수 종목 동시 분할매수/분할매도
- 해외주식/코스닥 등 KOSPI 외 시장 지원
- 모바일 앱 전용 UI

## 2. 페르소나 / 액터

- **주요 사용자(개인 투자자)**: 본인의 전략으로 당일 자동매매를 수행하고 성과를 확인한다.
- **시스템(자동매매 엔진)**: 조건 모니터링, 주문 실행, 체결/손익 계산, 리포트 생성을 담당한다.
- **외부 액터(키움 REST API)**: 인증/시세/주문/체결 데이터 제공.

## 3. 사용자 스토리 및 인수 기준

### US-01 종목 감시 범위 설정
**스토리**
- As a 개인 투자자, I want KOSPI 종목을 1~20개 범위에서 지정해 동시 감시하고 싶다 so that 내 전략 대상군을 유연하게 운영할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 사용자가 종목 리스트를 입력할 수 있는 설정 화면이 있고, When 종목 수를 1개 이상 20개 이하로 저장하면, Then 시스템은 유효성 오류 없이 저장한다.
2. Given 종목 수가 0개 또는 21개 이상인 입력, When 저장을 시도하면, Then 시스템은 저장을 거부하고 허용 범위(1~20)를 안내한다.

### US-02 09:03 기준가 설정 및 하락 추적
**스토리**
- As a 개인 투자자, I want 매일 09:03 현재가를 기준가로 삼아 이후 하락률과 전저점을 추적하고 싶다 so that 전략의 진입 시점을 일관되게 계산할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 장중 감시가 시작되었고 시각이 09:03에 도달했을 때, When 각 감시 종목의 현재가를 조회하면, Then 시스템은 해당 값을 종목별 당일 기준가로 기록한다.
2. Given 기준가가 기록된 상태, When 현재가가 기준가 대비 1% 이상 하락하면, Then 시스템은 해당 종목을 매수 후보 상태로 전환하고 전저점 추적을 시작한다.
3. Given 매수 후보 상태의 종목, When 더 낮은 가격이 발생하면, Then 시스템은 전저점을 갱신한다.

### US-03 반등 조건 충족 시 매수 트리거
**스토리**
- As a 개인 투자자, I want 전저점 대비 0.2% 이상 반등 시 매수 신호를 발생시키고 싶다 so that 하락 후 반등 구간에서 진입할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 종목이 기준가 대비 1% 이상 하락해 전저점을 추적 중이고, When 현재가가 추적 전저점 대비 0.2% 이상 상승하면, Then 해당 종목은 매수 조건 충족으로 판정된다.

### US-04 첫 충족 종목 전액 매수
**스토리**
- As a 개인 투자자, I want 여러 감시 종목 중 매수 조건을 먼저 만족한 1개 종목만 전액 매수하고 싶다 so that 전략 실행을 단순화하고 자금을 집중 운용할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 감시 종목이 2개 이상이고 동시 모니터링 중일 때, When 한 종목이 가장 먼저 매수 조건을 만족하면, Then 시스템은 해당 종목에 사용 가능 자금을 전액 배정해 매수 주문을 낸다.
2. Given 첫 매수 주문이 접수된 이후, When 다른 종목이 나중에 매수 조건을 만족하더라도, Then 시스템은 추가 매수를 실행하지 않는다.

### US-05 수익 1% 확보 후 이익보전 80% 기반 매도
**스토리**
- As a 개인 투자자, I want 매수 후 최소 수익 1% 달성 뒤 이익보전율이 80% 이하가 되면 현재가-2틱으로 매도하고 싶다 so that 수익을 보호하면서 이탈할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 매수 체결이 완료된 포지션, When 당일 매수가 대비 평가수익률이 1% 이상에 최초 도달하면, Then 시스템은 "최소 수익 확보" 상태를 활성화한다.
2. Given "최소 수익 확보" 상태에서 최고 수익률이 기록되어 있고, When 현재 수익률이 최고 수익률 대비 이익보전율 80% 이하로 하락하면, Then 시스템은 현재가 - 2틱 가격으로 매도 주문을 제출한다.
3. Given 현재 수익률이 1% 미만인 상태, When 가격 변동이 발생해도, Then 시스템은 이익보전율 조건만으로 매도를 실행하지 않는다.

### US-06 키움 REST 자격정보 브라우저 입력
**스토리**
- As a 개인 투자자, I want 키움 REST API 사용에 필요한 정보를 웹브라우저에서 입력하고 싶다 so that 서버 파일을 직접 수정하지 않고도 초기 설정할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 사용자가 설정 화면에 접근했을 때, When API 자격 항목을 입력하고 저장하면, Then 시스템은 유효성 검사를 통과한 값을 설정으로 저장한다.

### US-07 자격정보 Git 제외 저장
**스토리**
- As a 개인 투자자, I want 입력한 자격정보가 Git에 포함되지 않는 별도 설정 파일에 저장되길 원한다 so that 민감정보 유출 위험을 줄일 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 자격정보 저장이 수행되었을 때, When 저장 위치를 확인하면, Then 민감정보는 Git 추적 제외 대상 설정 파일에 존재해야 한다.
2. Given 소스 변경을 커밋 준비할 때, When Git 추적 파일 목록을 조회하면, Then 자격정보 파일은 포함되지 않는다.

### US-08 모의/실전 손쉬운 전환
**스토리**
- As a 개인 투자자, I want 모의투자와 실전투자를 쉽게 전환하고 싶다 so that 시장 상황과 검증 단계에 맞춰 운영할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 투자 모드 선택 UI가 있을 때, When 사용자가 모의를 선택하면, Then 주문/조회는 모의 환경으로 라우팅된다.
2. Given 동일 UI에서 실전을 선택하면, When 사용자가 저장 후 시작하면, Then 주문/조회는 실전 환경으로 라우팅된다.

### US-09 브라우저 기반 시작/모니터링/결과 확인
**스토리**
- As a 개인 투자자, I want 브라우저에서 매매 시작 명령을 내리고 진행 상태를 모니터링하며 결과를 확인하고 싶다 so that 개인 PC 서버를 원격으로 운용할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 설정이 유효한 상태, When 사용자가 브라우저에서 "투자 시작"을 실행하면, Then 시스템은 자동매매 프로세스를 시작하고 시작 시각/상태를 표시한다.
2. Given 자동매매가 실행 중일 때, When 모니터링 화면을 조회하면, Then 감시 종목 상태/주문 상태/포지션 상태를 확인할 수 있다.
3. Given 장 종료 또는 전략 종료 이후, When 결과 화면을 조회하면, Then 해당 일자의 집계 결과와 거래 상세를 확인할 수 있다.

### US-10 결과 리포트(세금/수수료/손익/수익률/상세거래)
**스토리**
- As a 개인 투자자, I want 결과 보고서에 세금 0.2%, 매도수수료 0.011%, 손익금, 수익률, 상세 거래내역이 반영되길 원한다 so that 실질 성과를 정확히 평가할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 매도 체결 데이터가 존재할 때, When 결과 리포트를 생성하면, Then 매도금액 기준 세금 0.2%와 매도수수료 0.011%가 계산 항목에 포함된다.
2. Given 일자별 거래가 존재할 때, When 결과 리포트를 조회하면, Then 총 손익금과 수익률이 표시된다.
3. Given 체결 이력이 존재할 때, When 상세내역을 열람하면, Then 종목/시각/수량/가격/수수료/세금/순손익을 확인할 수 있다.

### US-11 모니터링 화면 자동 새로고침
**스토리**
- As a 개인 투자자, I want 모니터링 화면이 자동으로 갱신되길 원한다 so that 리프레시 버튼을 수동으로 누르지 않고도 실시간 상태를 볼 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 자동매매가 실행 중이고 모니터링 화면이 열려 있을 때, When 사용자가 별도 새로고침 버튼을 누르지 않아도, Then 화면 데이터는 주기적으로 자동 갱신된다.
2. Given 자동 갱신이 동작 중일 때, When 화면의 데이터가 변경되면, Then 최신 값이 동일 화면에서 즉시 반영된다.
3. Given 자동 갱신 기능이 활성화되어 있을 때, When 사용자가 수동 리프레시를 수행하지 않아도, Then 모니터링 기능의 정상 동작에 영향이 없다.

### US-12 모니터링 12개 칼럼 고정 표시
**스토리**
- As a 개인 투자자, I want 모니터링 화면에 전략 핵심 12개 칼럼이 고정 순서로 표시되길 원한다 so that 상태를 빠르게 비교하고 의사결정을 확인할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 모니터링 화면이 표시될 때, When 테이블 헤더를 확인하면, Then 아래 12개 칼럼이 정확히 이 순서로 존재한다: 종목명|종목코드|9시3분 가격|현재 가격|전저점 시간|전저점 가격|매수 시간|매수 가격|전고점 시간|전고점 가격|매도 시간|매도 가격.
2. Given 모니터링 데이터가 갱신될 때, When 각 행 값을 확인하면, Then 모든 값은 위 12개 칼럼에 매핑되어 표시된다.
3. Given 모니터링 화면 렌더링 시, When 칼럼 구성을 확인하면, Then 지정 12개 외 추가/누락 칼럼이 없어야 한다.

### US-13 시간 필드 시분초(HH:MM:SS) 표기
**스토리**
- As a 개인 투자자, I want 시간 관련 필드에서 연월일 없이 시분초만 보고 싶다 so that 장중 의사결정에 필요한 정보만 간결하게 확인할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 모니터링 화면의 시간 칼럼(전저점 시간, 매수 시간, 전고점 시간, 매도 시간)이 있을 때, When 값이 표시되면, Then 형식은 HH:MM:SS여야 한다.
2. Given 리포트 화면/출력에서 시간 필드가 표시될 때, When 값을 확인하면, Then 날짜 정보 없이 HH:MM:SS만 표시된다.
3. Given 시간 값이 없는 상태일 때, When 화면을 조회하면, Then 빈값 또는 미기록 상태로 표시되고 날짜가 임의로 채워지지 않는다.

### US-14 조건 충족 시 주문 전송(잔액 부족 오류와 무관)
**스토리**
- As a 개인 투자자, I want 매수/매도 조건이 충족되면 증권사 응답 결과와 무관하게 주문 요청 자체는 전송되길 원한다 so that 전략 시그널의 실행 의도를 정확히 검증할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 매수 조건이 충족되었을 때, When 시스템이 주문을 처리하면, Then 증권사에서 잔액 부족 오류를 반환하더라도 매수 주문 요청은 전송 시도되어야 한다.
2. Given 매도 조건이 충족되었을 때, When 시스템이 주문을 처리하면, Then 증권사에서 잔액 부족 또는 주문 거부를 반환하더라도 매도 주문 요청은 전송 시도되어야 한다.
3. Given 주문 전송 후 실패 응답이 반환될 때, When 주문 이력을 확인하면, Then 주문 전송 시도 사실과 실패 사유가 기록되어야 한다.

### US-15 모니터링 정보의 리포트 연계 조회
**스토리**
- As a 개인 투자자, I want 모니터링에서 보던 핵심 정보가 사후 리포트에서도 동일하게 보이길 원한다 so that 장중 판단 근거를 사후에 검증할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 장중 모니터링에 표시된 종목별 핵심 데이터가 존재할 때, When 장 종료 후 리포트를 조회하면, Then 동일 항목(가격/시간/주문 관련 정보)을 리포트에서 확인할 수 있어야 한다.
2. Given 매수/매도 이벤트가 발생한 종목이 있을 때, When 리포트 상세를 열람하면, Then 매수 시간/가격과 매도 시간/가격이 표시된다.
3. Given 전저점/전고점 정보가 계산된 종목이 있을 때, When 리포트를 조회하면, Then 해당 시각/가격 정보가 누락 없이 반영된다.

### US-16 리포트 현재 가격의 15:30 종가 기준
**스토리**
- As a 개인 투자자, I want 리포트의 현재 가격이 장 종료 시점(15:30) 종가 기준으로 계산되길 원한다 so that 일일 성과를 동일 기준으로 비교할 수 있다.

**인수 기준 (Given/When/Then)**
1. Given 장 종료 시각(15:30)이 도달했을 때, When 당일 리포트를 생성하면, Then 리포트의 현재 가격은 15:30 종가를 사용한다.
2. Given 장중 시각에 중간 조회를 수행하더라도, When 최종 리포트가 확정되면, Then 현재 가격 필드는 15:30 종가로 재평가되어 표시된다.
3. Given 리포트 현재 가격과 시세 데이터가 비교 가능할 때, When 검증하면, Then 리포트 값과 15:30 종가가 일치해야 한다.

## 4. 전략 요구사항 명세(명시)

- 감시 종목 수: KOSPI 1~20개
- 기준 시각/가격: 매일 09:03 현재가를 기준가로 사용
- 매수 트리거:
  - 기준가 대비 1% 이상 하락 발생
  - 하락 구간 전저점 추적
  - 전저점 대비 현재가 0.2% 이상 반등 시 매수 조건 충족
- 매수 실행: 매수 조건을 가장 먼저 만족한 1개 종목에 전액 매수
- 매도 트리거:
  - 매수가 대비 최소 수익 1% 확보 이후
  - 이익보전율이 80% 이하로 하락 시
  - 현재가 - 2틱 지정가 매도
- 모니터링 표시:
  - 화면은 수동 리프레시에 의존하지 않고 자동 갱신되어야 함
  - 칼럼은 아래 12개를 정확히 동일 순서로 제공해야 함
  - 종목명|종목코드|9시3분 가격|현재 가격|전저점 시간|전저점 가격|매수 시간|매수 가격|전고점 시간|전고점 가격|매도 시간|매도 가격
  - 시간 칼럼은 HH:MM:SS로 표기(날짜 미포함)
- 주문 전송 정책:
  - 매수/매도 조건 충족 시 주문 요청을 전송해야 함
  - 증권사 잔액 부족/주문 거부 오류는 주문 요청 전송 의무를 면제하지 않음

## 5. 운영 요구사항 명세

- 키움 REST 자격정보를 브라우저에서 입력 가능해야 함
- 자격정보는 Git에 포함되지 않는 설정으로 저장되어야 함
- 모의/실전 전환이 쉬워야 함
- 브라우저에서 투자 시작 명령 가능해야 함
- 브라우저에서 실행 모니터링 및 결과 리포트 확인 가능해야 함
- 결과 리포트에 다음 포함:
  - 세금 0.2%
  - 매도수수료 0.011%
  - 손익금(PnL)
  - 수익률
  - 세부 거래 내역
  - 모니터링에서 확인한 가격/시간/주문 핵심 정보
  - 현재 가격은 15:30 장종료 종가 기준

## 6. 인터뷰-스토리 추적성(Traceability)

| 인터뷰 ID | 출처 | 인터뷰 진술(요약) | 반영 스토리/섹션 |
|---|---|---|---|
| I-01 | 20260217 | 사용자: 주식 투자자 | US-01~US-16 페르소나 |
| I-02 | 20260217 | 독자적 투자 전략으로 트레이딩 | 1.1 제품 목표, US-02~US-05 |
| I-03 | 20260217 | 전략은 지속 변경/추가 가능 | 1.2 범위(설정 기반 운영), US-01, US-08 |
| I-04 | 20260217 | 대상: KOSPI 약 20종목 | US-01, 4 전략 요구사항 |
| I-05 | 20260217 | 키움 REST API 사용 | 2 액터, US-06~US-08 |
| I-06 | 20260217 | REST 사용자 정보 브라우저 입력 | US-06 |
| I-07 | 20260217 | 입력 정보는 Git 제외 별도 config 저장 | US-07, 5 운영 요구사항 |
| I-08 | 20260217 | 모의/실전 손쉬운 전환 | US-08 |
| I-09 | 20260217 | 투자 시작은 브라우저 명령 | US-09 |
| I-10 | 20260217 | 투자 동작 브라우저 모니터링 | US-09, US-11~US-13 |
| I-11 | 20260217 | 개인 PC 서버에서 운영 | US-09(운영 전제) |
| I-12 | 20260217 | 투자 결과 브라우저 확인 | US-09, US-10, US-15, US-16 |
| I-13 | 20260217 | 결과 보고서: 세금 0.2%, 수수료 0.011% 포함 | US-10 |
| I-14 | 20260217 | 결과 보고서: 수익률/수익금 포함 | US-10 |
| I-15 | 20260217 | 결과 보고서: 세부 거래내역 포함 | US-10 |
| I-16 | 20260217 | 전략: 매수 Trailing Buy + 매도 Trailing Stop | US-02~US-05 |
| I-17 | 20260217 | 1~20개 동시 모니터링, 첫 충족 종목 전액 매수 | US-01, US-04 |
| I-18 | 20260217 | 09:03 기준가, -1% 하락 후 전저점 대비 +0.2% 반등 매수 | US-02, US-03 |
| I-19 | 20260217 | 최소 +1% 수익 확보 후, 이익보전 80% 이하 시 현재가-2틱 매도 | US-05 |
| I-20 | 20260218 | 모니터링 화면 수동 리프레시 불편, 자동 갱신 필요 | US-11, 4 전략 요구사항 |
| I-21 | 20260218 | 모니터링 칼럼 12개를 지속 갱신 표시 | US-12, 4 전략 요구사항 |
| I-22 | 20260218 | 시간 항목은 연월일 제외, 시분초만 표시 | US-13 |
| I-23 | 20260218 | 매수 조건 충족 시 주문 전송(잔액 부족 오류 무관) | US-14 |
| I-24 | 20260218 | 매도 조건 충족 시 주문 전송 및 매도 시간/가격 기록 | US-14, US-15 |
| I-25 | 20260218 | 위 모니터링 내용은 나중에 리포트에서도 확인 | US-15, 5 운영 요구사항 |
| I-26 | 20260218 | 리포트 현재가격은 15:30 장종료 종가 | US-16, 5 운영 요구사항 |

## 7. 비고

- 본 문서는 인터뷰 기반 개정본(v0.2.0)이며, v0.1.0 요구사항을 유지하면서 2026-02-18 인터뷰 내용을 확장 반영했다.
- 구현 단계에서 자동 갱신 주기, 리포트 데이터 보존 기간, 주문 실패 재시도 정책은 하위 설계(ILD/LLD)에서 구체화한다.
