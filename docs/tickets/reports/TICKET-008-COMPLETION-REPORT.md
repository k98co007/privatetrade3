# TICKET-008 COMPLETION REPORT

- 티켓 ID: TICKET-008
- 티켓명: LLD-TSE 작성
- 완료일: 2026-02-17
- 담당: LLD agent (TSE)
- 입력 문서:
  - `docs/hld/HLD-v0.1.0.md` (4.2, 5)
  - `docs/srs/SRS-v0.1.0.md`
  - `docs/lld/LLD-OPM-v0.1.0.md`
- 산출 문서:
  - `docs/lld/LLD-TSE-v0.1.0.md`

## 1) 수행 결과

- TSE 모듈 범위/책임을 HLD 4.2 기준으로 상세화 완료
- 08:30 기준가 캡처→1% 하락 감지→전저점 추적→0.2% 반등 매수 트리거 상태머신 정의 완료
- 1~20 종목 동시 감시 시 최초 충족 1종목 전액 매수 제약(노-더블-바이) 설계 완료
- 매수 후 +1% 최소수익 확보 상태 및 이익보전율 80% 이하 매도 신호 설계 완료
- 종목 단위/포트폴리오 단위 이중 상태머신과 시간 경계 규칙 명세 완료
- TSE→OPM 명령 계약(매수/매도) 및 TSE→PRP 전략 이벤트 계약 정의 완료
- 동시성 우선순위 규칙(시각→시퀀스→감시목록순)과 엣지 케이스 정리 완료
- 핵심 의사코드(매수 전 판정, 매수 후 매도 판정) 작성 완료
- 기능/경계 테스트 포인트(TP-001~TP-016) 작성 완료
- HLD/SRS 추적성 매트릭스 작성 완료

## 2) 핵심 설계 결정

### 결정 1: 단일매수 제약은 전역 게이트로 강제
- 방식: `globalBuyGate`를 원자적으로 획득한 1건만 BUY 명령 발행
- 근거: SRS FR-006, FR-007
- 영향: 다중 종목 동시 트리거 환경에서도 추가 매수 원천 차단

### 결정 2: 상태머신을 종목/포트폴리오 2계층으로 분리
- 방식: 종목 상태는 진입 신호 판정, 포트폴리오 상태는 주문/보유/청산 제약 관리
- 근거: HLD 4.2 전략 판정 책임과 HLD 5 인터페이스 경계
- 영향: 전략 판정과 주문 실행(OPM) 경계를 명확히 유지

### 결정 3: 매도 조건은 최소수익 확보 이후에만 활성화
- 방식: `minProfitLocked=true` 이후 `profitPreservationRate<=80`에서만 SELL 신호
- 근거: SRS FR-008~FR-010
- 영향: 초기 변동 구간에서의 조기 매도 방지, 규칙 일관성 확보

## 3) 체크리스트

- [x] HLD 4.2 전략 책임 반영
- [x] HLD 5 모듈 인터페이스 계약 반영
- [x] SRS FR-002~FR-010 반영
- [x] 단일 종목 전액 매수/추가 매수 차단 반영
- [x] 시간 경계(08:30 기준가, 거래일 초기화) 반영
- [x] OPM/PRP 이벤트 계약 반영
- [x] 의사코드 및 테스트 포인트 반영
- [x] 한국어 문서화

## 4) 리스크 및 후속 권고

- 리스크: 장중 동일 타임스탬프 다중 트리거 시 입력 순서 불안정하면 종목 선택 비결정성 가능
- 권고: 시세 이벤트에 단조 증가 시퀀스 필드를 부여해 동률 판정 안정화
- 권고: 거래일 경계/지연 이벤트 폐기 정책을 UAG 모니터링 화면에 명시하여 운영 혼선 최소화
- 권고: OPM 체결 지연 시나리오를 포함한 통합테스트(LLD-OPM 연계)를 ILD 단계에서 우선 수행

## 5) 결론

TICKET-008 요구사항(LLD-TSE 문서 신규 작성 및 전략 상태머신/시간 경계/단일매수 제약/OPM·PRP 계약/엣지 케이스/의사코드/테스트 포인트 포함)을 충족하여 완료 처리한다.
