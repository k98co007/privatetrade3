# TICKET-018 COMPLETION REPORT

- 티켓 ID: TICKET-018
- 티켓명: ILD-KIA 작성
- 완료일: 2026-02-17
- 담당: ILD agent (KIA)
- 입력 문서:
  - `docs/lld/LLD-KIA-v0.1.0.md`
- 산출 문서:
  - `docs/ild/ILD-KIA-v0.1.0.md`

## 1) 수행 결과

- KIA 모듈 구현 상세 설계(ILD) 신규 작성 완료
- API 클라이언트의 구체 메서드 시그니처(게이트웨이/내부 클라이언트/토큰/라우터) 명세 완료
- 인증 토큰 갱신 구현 단계(선제 갱신, single-flight, 401 강제 갱신, 모드 전환 invalidate) 상세화 완료
- Mock/Live 라우팅 구현 방식(Resolver + CSM base_url 연계 + 서비스 라우팅 테이블) 명세 완료
- 재시도/백오프 의사코드(지수 백오프+jitter, retryable 기준, 주문 timeout 멱등 가드) 작성 완료
- 표준 오류 매핑 테이블(HTTP/네트워크/파싱/설정 오류 -> KIA 표준 코드) 작성 완료
- 테스트 포인트(토큰/라우팅/재시도/오류 매핑/멱등성) 정의 완료
- 한국어 문서화 완료

## 2) 핵심 설계 결정

### 결정 1: API 호출 책임 분리
- 방식: `KiaGateway`(업무 계약) + `KiaApiClient`(HTTP 호출) + `EndpointResolver`/`TokenProvider`(횡단 기능)
- 근거: LLD-KIA 2장, 4장, 7장
- 영향: 테스트 용이성 향상, 모드/토큰/재시도 정책의 독립 변경 가능

### 결정 2: 토큰 갱신은 선제 + 단일비행(single-flight)
- 방식: `refresh_at` 기반 선제 갱신 + 모드별 락 + 401 시 1회 강제 갱신
- 근거: LLD-KIA 3장
- 영향: 동시성 환경에서 중복 갱신 감소, 만료 토큰 호출 실패율 저감

### 결정 3: 주문 timeout은 재주문보다 멱등 조회 우선
- 방식: `client_order_id` 기준 조회/캐시 우선, 확인 후에만 후속 처리
- 근거: LLD-KIA 6.2, 6.3, 9.2
- 영향: 중복 주문 리스크 완화, 운영 안전성 향상

## 3) 체크리스트

- [x] ILD 문서 신규 생성
- [x] 구체 API 클라이언트 메서드 시그니처 작성
- [x] 인증 토큰 갱신 구현 단계 작성
- [x] Mock/Live 라우팅 구현 작성
- [x] 재시도/백오프 의사코드 작성
- [x] 표준 오류 매핑 테이블 작성
- [x] 한국어 작성

## 4) 리스크 및 후속 권고

- 리스크: 브로커 실 API의 세부 오류코드(본문 필드)가 문서 가정과 다를 수 있음
- 권고: 샌드박스/모의계정으로 오류코드 샘플 수집 후 `error_mapper` 매핑 테이블 1회 보정
- 권고: 주문 멱등 조회 API 지연 시나리오에 대한 타임아웃/재조회 정책을 운영 파라미터화

## 5) 결론

TICKET-018 요구사항(LLD-KIA 기반 ILD-KIA 신규 작성, API 시그니처/토큰 갱신/모드 라우팅/재시도·백오프/오류 매핑 포함)을 충족하여 완료 처리한다.
