# TICKET-004 COMPLETION REPORT

- 티켓 ID: TICKET-004
- 티켓명: LLD-PRP 작성
- 완료일: 2026-02-17
- 담당: LLD agent (PRP)
- 입력 문서:
  - `docs/hld/HLD-v0.1.0.md` (4.6, 5)
  - `docs/srs/SRS-v0.1.0.md`
- 산출 문서:
  - `docs/lld/LLD-PRP-v0.1.0.md`

## 1) 수행 결과
- PRP 모듈 범위/책임을 HLD 4.6 기준으로 상세화 완료
- 모듈 인터페이스(입력 이벤트 DTO, 조회 Query/Response DTO, 공통 오류 DTO) 정의 완료
- 이벤트 영속화/리포트 생성 시퀀스 플로우 정의 완료
- 저장소 기술을 SQLite로 확정하고 테이블/인덱스 스키마 제시 완료
- 리포트 계산식(세금 0.2%, 매도수수료 0.011%, 순손익/수익률) 명세 완료
- 재시작 복구 의사코드 및 오류 처리 정책 정리 완료
- HLD/SRS 추적성 매트릭스 작성 완료

## 2) 핵심 설계 결정

### 결정 1: 저장소는 SQLite 채택
- 사유: 단일 파일 기반 운영 편의성 + 트랜잭션 원자성 + 일자/종목 조회 성능 확보
- 영향: `strategy_events`, `order_events`, `execution_events`, `position_snapshots`, `trade_details`, `daily_reports` 스키마로 구현 기준 고정

### 결정 2: 리포트 계산 규칙 고정
- 세금: `매도금액 * 0.002`
- 매도수수료: `매도금액 * 0.00011`
- 순손익: `매도금액 - 매수금액 - 세금 - 매도수수료`
- 수익률: `순손익 / 매수금액 * 100`

### 결정 3: 복구 절차는 스냅샷 + 체결 재동기화
- 마지막 스냅샷 우선 복원
- KIA 체결 조회 결과를 PRP와 비교해 누락 체결만 반영
- 중복 체결은 고유키로 차단

## 3) 체크리스트
- [x] HLD 4.6 책임 항목 반영
- [x] HLD 5 인터페이스 계약 반영
- [x] SRS FR-016/017 계산 및 조회 요구 반영
- [x] SRS NFR-003/004/005 반영
- [x] 한국어 문서화

## 4) 리스크 및 후속 권고
- 리스크: SQLite 파일 손상 시 복구 난이도 상승 가능
- 권고: 일 단위 DB 백업(`.db` + `.wal`) 및 시작 시 무결성 체크 수행
- 권고: 계산 반올림 규칙(금액 소수점 2자리, 수익률 4자리) 테스트 케이스 고정

## 5) 결론
TICKET-004 요구사항(LLD-PRP 문서 신규 작성 및 인터페이스/저장소/계산/복구/추적성 포함)을 충족하여 완료 처리한다.
