# TICKET-005 COMPLETION REPORT

- 티켓 ID: TICKET-005
- 티켓명: LLD-CSM 작성
- 완료일: 2026-02-17
- 담당: LLD agent (CSM)
- 입력 문서:
  - `docs/hld/HLD-v0.1.0.md` (4.5, 7, 8)
  - `docs/srs/SRS-v0.1.0.md`
- 산출 문서:
  - `docs/lld/LLD-CSM-v0.1.0.md`

## 1) 수행 결과
- CSM 모듈 범위/책임을 HLD 4.5 기준으로 상세화 완료
- 설정/시크릿 데이터 모델(`ConfigSnapshot`, `CredentialEnvelope`) 정의 완료
- 종목(1~20), 모드(mock/live), 자격정보 검증 규칙 명세 완료
- 저장 경로 정책 및 `.gitignore` 안전 전략 정리 완료
- 마스킹 규칙과 암호화 접근(AES-256-GCM + OS 보호키) 설계 결정 완료
- `UAG`/`KIA` 인터페이스 계약(DTO) 정의 완료
- 모드 전환 선행조건, 시퀀스, 의사코드, 오류 모델 정의 완료
- HLD/SRS 추적성 매트릭스 작성 완료

## 2) 핵심 설계 결정

### 결정 1: 시크릿은 평문 저장 금지, 암호문만 저장
- 방식: `runtime/secrets/credentials.local.enc.json`에 AES-256-GCM 암호문 저장
- 키 관리: OS 보호 저장소 기반 마스터 키 사용
- 영향: 설정 파일에는 `credentialsRef`만 저장하여 평문 노출면 최소화

### 결정 2: 모드 전환은 비거래 상태 강제
- 조건: 미체결 주문 0, 보유 포지션 0, 엔진 상태 `IDLE`
- Live 추가 조건: `liveModeConfirmed=true` 및 자격정보 복호화/검증 성공
- 영향: 실전 전환 오작동 리스크 감소

### 결정 3: CSM을 모드/자격정보의 단일 소스로 고정
- `KIA`는 호출 시점마다 `CSM`에서 모드+자격정보를 해석
- 영향: 모드 라우팅 일관성 확보(SRS FR-014)

## 3) 체크리스트
- [x] HLD 4.5 책임 항목 반영
- [x] HLD 7 보안/설정관리 반영
- [x] HLD 8 모드 전환 정책 반영
- [x] SRS FR-001/012/013/014 반영
- [x] SRS NFR-002/003 반영
- [x] 한국어 문서화

## 4) 리스크 및 후속 권고
- 리스크: OS 보호 저장소 접근 실패 시 자격정보 복호화 실패 가능
- 권고: 시작 시 키 획득 self-check와 명확한 복구 가이드 제공
- 권고: `.gitignore` 정책을 CI/사전커밋 검증으로 자동화
- 권고: 모드 전환 선행조건 위반 시 사용자 액션 가이드(미체결 취소/포지션 정리) 노출

## 5) 결론
TICKET-005 요구사항(LLD-CSM 문서 신규 작성 및 설정·시크릿 모델/검증/저장정책/보안/인터페이스/전환규칙/시퀀스/오류/추적성 포함)을 충족하여 완료 처리한다.
