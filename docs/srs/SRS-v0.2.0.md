# SRS v0.2.0

- 문서명: 소프트웨어 요구사항 명세서 (SRS)
- 버전: v0.2.0
- 작성일: 2026-02-19
- 기반 문서: `docs/userstory/USERSTORY-v0.2.0.md`, `docs/userinterview/20260217.md`, `docs/userinterview/20260218.md`
- 적용 범위: 키움 REST API 기반 개인 자동매매 시스템(웹 UI + 로컬 실행 서버)

## 1. 문서 개요/범위

### 1.1 목적
본 문서는 개인 투자자의 전략(매수 Trailing Buy + 매도 Trailing Stop)을 키움 REST API로 자동 실행하기 위한 기능/비기능 요구사항을 정의한다.

### 1.2 범위
- KOSPI 종목 1~20개 동시 감시
- 09:03 기준가 기반 매수 조건 계산
- 조건 최초 충족 1개 종목 전액 매수
- 최소 수익 1% 확보 이후 이익보전 80% 규칙 기반 매도
- 웹 UI 기반 설정/시작/모니터링/결과 조회
- 세금/수수료 반영 리포트 생성
- 모니터링 화면 자동 갱신(수동 버튼 비의존)
- 모니터링 12개 칼럼 고정 스키마 및 시간 HH:MM:SS 표기
- 조건 충족 시 주문 전송 시도 보장(증권사 잔액 부족/거부 응답과 무관)
- 모니터링 정보와 리포트 필드 연계 조회
- 리포트 현재가격의 15:30 장종료 종가 기준

### 1.3 범위 제외
- 복수 종목 동시 분할매수/분할매도
- KOSPI 외 시장 지원
- 모바일 전용 앱

## 2. 용어 정의

- 기준가(Base Price): 당일 09:03 시점 종목 현재가
- 전저점(Local Low): 기준가 이후 하락 구간에서 관측된 최저가
- 매수 후보(Buy Candidate): 기준가 대비 1% 이상 하락하여 전저점 추적 중인 상태
- 반등률(Rebound Rate): `(현재가 - 전저점) / 전저점 * 100`
- 평가수익률(Current Profit Rate): `(현재가 - 매수가) / 매수가 * 100`
- 최고수익률(Max Profit Rate): 매수 이후 관측된 평가수익률의 최댓값
- 이익보전율(Profit Preservation Rate): `(현재수익률 / 최고수익률) * 100`
- 2틱: 해당 종목 호가단위 2개 가격 간격
- 모니터링 12개 칼럼: `종목명|종목코드|9시3분 가격|현재 가격|전저점 시간|전저점 가격|매수 시간|매수 가격|전고점 시간|전고점 가격|매도 시간|매도 가격`

## 3. 시스템 컨텍스트

- 사용자(개인 투자자): 웹 UI에서 설정, 투자 시작, 진행 모니터링, 결과 조회 수행
- 자동매매 서버(개인 PC): 전략 계산, 주문 실행, 체결/손익 계산, 리포트 생성 수행
- 키움 REST API: 인증, 시세 조회, 주문 요청, 체결/잔고 조회 제공
- 로컬 저장소: Git 제외 자격정보 및 운영 데이터 저장

## 4. 기능 요구사항

### FR-001 감시 종목 등록/검증
시스템은 사용자가 입력한 감시 종목을 KOSPI 대상 1개 이상 20개 이하로만 저장해야 한다.

### FR-002 기준가 확정
시스템은 매 거래일 09:03 시점의 현재가를 종목별 기준가로 1회 확정 저장해야 한다.

### FR-003 하락 감지 및 전저점 추적 시작
시스템은 기준가 대비 현재가가 1% 이상 하락하면 해당 종목을 매수 후보 상태로 전환하고 전저점 추적을 시작해야 한다.

### FR-004 전저점 갱신
시스템은 매수 후보 상태에서 더 낮은 가격이 발생할 때 전저점을 즉시 갱신해야 한다.

### FR-005 매수 조건 판정
시스템은 반등률이 0.2% 이상이 되면 해당 종목을 매수 조건 충족으로 판정해야 한다.

### FR-006 단일 종목 전액 매수
시스템은 다중 감시 종목 중 매수 조건을 최초 충족한 1개 종목에 대해 사용 가능 자금을 전액 배정하여 매수 주문을 제출해야 하며, 매수 주문 가격은 `현재가 + 2틱`으로 산정해야 한다.

### FR-007 추가 매수 차단
시스템은 최초 매수 주문 접수 이후 동일 거래일에 다른 종목의 매수 조건 충족이 발생해도 추가 매수를 제출하지 않아야 한다.

### FR-008 최소 수익 확보 상태 전환
시스템은 매수 체결 후 평가수익률이 1% 이상에 최초 도달하면 최소 수익 확보 상태를 활성화해야 한다.

### FR-009 최고수익률 추적
시스템은 포지션 보유 중 관측된 평가수익률 최댓값을 최고수익률로 지속 갱신해야 한다.

### FR-010 매도 조건 판정
시스템은 최소 수익 확보 상태에서 이익보전율이 80% 이하가 되면 매도 조건 충족으로 판정해야 한다.

### FR-011 매도 주문 가격 산정
시스템은 FR-010 충족 시 매도 주문 가격을 `현재가 - 2틱`으로 산정하여 지정가 주문을 제출해야 한다.

### FR-012 자격정보 웹 입력
시스템은 키움 REST API 자격정보 입력/수정 UI를 제공하고 필수 항목 검증 후 저장해야 한다.

### FR-013 자격정보 로컬 비추적 저장
시스템은 자격정보를 Git 추적 제외 대상 로컬 설정 파일에 저장해야 하며, 원격 저장소 추적 대상에 포함하지 않아야 한다.

### FR-014 모의/실전 전환
시스템은 모의투자/실전투자 모드를 웹 UI에서 선택 가능하게 제공하고, 선택 모드에 맞는 API 엔드포인트로 주문/조회 요청을 라우팅해야 한다.

### FR-015 투자 시작/모니터링
시스템은 웹 UI에서 투자 시작 명령을 받아 자동매매를 실행하고, 감시 상태/주문 상태/포지션 상태를 표시해야 한다.

### FR-016 결과 리포트 생성
시스템은 거래 종료 후 리포트를 생성해야 하며, 다음 계산을 포함해야 한다.
- 세금: `매도금액 * 0.002`
- 매도수수료: `매도금액 * 0.00011`
- 순손익: `매도금액 - 매수금액 - 세금 - 매도수수료`
- 수익률: `순손익 / 매수금액 * 100`

### FR-017 결과 리포트 조회
시스템은 웹 UI에서 일자별 총 손익금, 수익률, 상세 거래내역(종목/시각/수량/가격/수수료/세금/순손익)을 조회 가능해야 한다.

### FR-018 모니터링 자동 갱신 계약
시스템은 자동매매 실행 중 모니터링 화면 데이터를 주기적으로 자동 갱신해야 하며, 사용자의 수동 새로고침 버튼 동작 여부와 무관하게 최신 데이터를 반영해야 한다.

### FR-019 모니터링 12개 칼럼 고정 스키마
시스템은 모니터링 화면에 다음 12개 칼럼을 정확히 동일한 명칭과 순서로 제공해야 하며, 추가/누락 칼럼 없이 렌더링해야 한다.
- `종목명|종목코드|9시3분 가격|현재 가격|전저점 시간|전저점 가격|매수 시간|매수 가격|전고점 시간|전고점 가격|매도 시간|매도 가격`

### FR-020 시간 필드 HH:MM:SS 표기
시스템은 모니터링 및 리포트의 시간 필드(전저점 시간, 매수 시간, 전고점 시간, 매도 시간)를 날짜 없이 `HH:MM:SS` 형식으로 표시해야 하며, 값이 없는 경우 임의 날짜를 채우지 않아야 한다.

### FR-021 주문 전송 정책(증권사 오류 무관)
시스템은 매수 또는 매도 조건이 충족되면 증권사 잔액 부족/주문 거부 등의 실패 응답 가능성과 무관하게 주문 요청 전송을 시도해야 하며, 전송 시도 시각/요청 정보/실패 사유를 주문 이력에 기록해야 한다.

### FR-022 모니터링-리포트 필드 연계
시스템은 장중 모니터링에서 제공한 가격/시간/주문 관련 핵심 필드를 장종료 후 리포트에서 동일 의미의 항목으로 조회 가능하게 제공해야 한다.

### FR-023 리포트 현재가격 기준 시각
시스템은 당일 최종 리포트의 현재가격 필드를 15:30 장종료 시점 종가로 확정해야 하며, 장중 중간 조회값이 존재하더라도 최종 리포트 확정 시 15:30 종가 기준으로 재평가해야 한다.

## 5. 비기능 요구사항

### NFR-001 요구사항 검증 가능성
모든 요구사항은 입력 조건, 계산식, 판정 기준, 출력 결과가 명시된 검증 가능한 문장으로 작성되어야 한다.

### NFR-002 보안(민감정보)
자격정보는 평문 로그에 출력되지 않아야 하며, 애플리케이션 로그/에러 메시지에서 마스킹 처리되어야 한다.

### NFR-003 신뢰성(중단 복구)
개인 PC 재기동 또는 프로세스 재시작 후 마지막 저장 시점의 설정(종목, 모드, 자격정보 참조)을 복원할 수 있어야 한다.

### NFR-004 계산 일관성
세금/수수료/손익/수익률 계산은 동일 입력에 대해 항상 동일 결과를 반환해야 하며, 소수점 처리 규칙(반올림/절사)은 시스템 전역에서 일관되어야 한다.

### NFR-005 감사 가능성
주문 요청/응답, 체결 이벤트, 리포트 생성 시각을 추적 가능한 이벤트 로그로 보관해야 한다.

## 6. 외부 인터페이스 요구사항

### 6.1 Kiwoom REST 인터페이스
- 인증 인터페이스: 액세스 토큰 발급/갱신
- 시세 인터페이스: 종목 현재가 조회(기준가 확정, 전저점 추적, 반등률 계산, 15:30 종가 확정에 사용)
- 주문 인터페이스: 매수/매도 주문 제출(모의/실전 라우팅)
- 체결/잔고 인터페이스: 체결 확인, 보유 수량/평균단가 조회

### 6.2 웹 UI 인터페이스
- 설정 화면: 종목 목록(1~20), 투자 모드(모의/실전), 자격정보 입력/저장
- 제어 화면: 투자 시작 명령
- 모니터링 화면: 감시 상태, 매수 후보 상태, 주문/체결 상태, 포지션 상태
- 결과 화면: 일자별 손익 요약, 수익률, 거래 상세

### 6.3 로컬 저장 인터페이스
- 저장 대상: 자격정보, 전략 실행 상태, 리포트 데이터
- 저장 조건: Git 추적 제외 경로 사용
- 접근 정책: 애플리케이션 프로세스만 읽기/쓰기

## 7. 데이터 요구사항

### 7.1 핵심 데이터 엔터티
- `WatchSymbol`: 종목코드, 종목명, 기준가, 전저점, 상태
- `Position`: 종목코드, 매수가, 수량, 현재수익률, 최고수익률, 최소수익확보여부
- `Order`: 주문ID, 종목코드, 주문유형(매수/매도), 주문가, 수량, 접수시각, 상태
- `Execution`: 체결ID, 주문ID, 체결가, 체결수량, 체결시각
- `DailyReport`: 일자, 총매수금액, 총매도금액, 총세금, 총수수료, 총순손익, 총수익률
- `TradeDetail`: 일자, 종목코드, 매수/매도 시각, 수량, 매수가, 매도가, 세금, 수수료, 순손익

### 7.2 계산 데이터 규칙
- 반등률 계산은 전저점 유효 시점 이후 데이터에 한정한다.
- 이익보전율 계산은 `최고수익률 > 0`이며 최소 수익 확보 상태에서만 수행한다.
- 리포트 계산 단위는 거래 1건 기준으로 산출 후 일자 합계로 집계한다.
- 리포트 현재가격은 최종 확정 시 15:30 종가를 기준으로 한다.

### 7.3 모니터링/리포트 표시 스키마 규칙
- 모니터링 테이블은 정확히 12개 칼럼으로 구성되며 고정 순서를 유지한다.
- 12개 칼럼은 리포트 상세에서 동일 의미의 필드로 조회 가능해야 한다.
- 시간 값 표현은 `HH:MM:SS`이며 날짜 문자열을 포함하지 않는다.

## 8. 제약사항/가정

- 시스템 실행 환경은 사용자의 집에서 운영되는 개인용 PC 서버이다.
- 거래 대상 시장은 KOSPI로 한정한다.
- 전략 파라미터(1%, 0.2%, 매수 +2틱, 1%, 80%, 매도 -2틱)는 v0.2.0에서도 고정값으로 가정한다.
- 키움 REST API의 가용성/응답 지연은 외부 시스템 제약으로 간주한다.
- 장중 시각 기준은 로컬 서버 시계를 기준으로 하며, 시스템 시간 동기화가 선행되어야 한다.

## 9. 수용 기준

- AC-001: 종목 저장은 1~20개에서만 성공하고 범위 외 입력은 실패해야 한다.
- AC-002: 09:03 시점 기준가가 종목별 1회 기록되어야 한다.
- AC-003: 기준가 대비 -1% 하락 후 전저점 대비 +0.2% 반등 시 매수 조건이 참으로 판정되어야 한다.
- AC-004: 다중 종목 중 최초 충족 1건만 `현재가+2틱` 지정가로 전액 매수되고 추가 매수는 발생하지 않아야 한다.
- AC-005: 평가수익률 +1% 달성 이후 이익보전율 80% 이하 시 `현재가-2틱` 매도 주문이 발생해야 한다.
- AC-006: 자격정보는 웹에서 저장 가능해야 하며 Git 추적 목록에 포함되지 않아야 한다.
- AC-007: 모의/실전 전환 후 주문/조회가 선택 모드 환경으로 라우팅되어야 한다.
- AC-008: 결과 리포트에 세금 0.2%, 매도수수료 0.011%, 순손익, 수익률, 상세 거래내역이 포함되어야 한다.
- AC-009: 모니터링 화면은 자동매매 실행 중 주기적으로 자동 갱신되어야 하며, 수동 새로고침 버튼 조작 없이 최신 상태를 반영해야 한다.
- AC-010: 모니터링 화면은 지정된 12개 칼럼을 정확한 명칭/순서로만 표시해야 하며 추가/누락 칼럼이 없어야 한다.
- AC-011: 모니터링/리포트 시간 필드는 값 존재 시 `HH:MM:SS`로 표시되고 날짜 정보가 포함되지 않아야 하며, 값 부재 시 임의 날짜가 채워지지 않아야 한다.
- AC-012: 매수/매도 조건 충족 시 증권사 잔액 부족/주문 거부 응답 여부와 무관하게 주문 요청 전송 시도가 발생해야 하고, 실패 시 이력에 시도 사실과 사유가 기록되어야 한다.
- AC-013: 리포트에서 모니터링의 핵심 가격/시간/주문 필드를 조회할 수 있어야 하며, 최종 리포트 현재가격은 15:30 종가와 일치해야 한다.

## 10. 추적성 매트릭스 (유저스토리 -> SRS 요구사항)

| 유저스토리 ID | 설명(요약) | 매핑 요구사항 |
|---|---|---|
| US-01 | KOSPI 1~20 종목 감시 | FR-001, AC-001 |
| US-02 | 09:03 기준가 및 하락 추적 | FR-002, FR-003, FR-004, AC-002 |
| US-03 | 전저점 대비 0.2% 반등 매수 신호 | FR-005, AC-003 |
| US-04 | 첫 충족 종목 전액 매수 | FR-006, FR-007, AC-004 |
| US-05 | +1% 이후 이익보전 80% 매도 | FR-008, FR-009, FR-010, FR-011, AC-005 |
| US-06 | 키움 자격정보 브라우저 입력 | FR-012 |
| US-07 | 자격정보 Git 제외 저장 | FR-013, NFR-002, AC-006 |
| US-08 | 모의/실전 전환 | FR-014, AC-007 |
| US-09 | 브라우저 시작/모니터링/결과 확인 | FR-015, FR-017 |
| US-10 | 세금/수수료 반영 결과 리포트 | FR-016, FR-017, NFR-004, AC-008 |
| US-11 | 모니터링 화면 자동 새로고침 | FR-018, AC-009 |
| US-12 | 모니터링 12개 칼럼 고정 표시 | FR-019, AC-010 |
| US-13 | 시간 필드 HH:MM:SS 표기 | FR-020, AC-011 |
| US-14 | 조건 충족 시 주문 전송(오류 무관) | FR-021, NFR-005, AC-012 |
| US-15 | 모니터링 정보 리포트 연계 조회 | FR-022, AC-013 |
| US-16 | 리포트 현재가격 15:30 종가 기준 | FR-023, AC-013 |

---
본 문서는 v0.1.0 기준 요구사항을 유지하면서 2026-02-18 인터뷰 반영 사항(자동 갱신, 12칼럼, HH:MM:SS, 주문 전송 정책, 리포트 연계, 15:30 종가 기준)을 확장 반영한 SRS v0.2.0이다.
